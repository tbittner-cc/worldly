---
import Base from '../layouts/Base.astro';
import Header from '../components/Header.astro';
---

<Base>
	<!-- In our current iteration, the lang attribute is not used.  It will 
	 be useful if we decide to have a dropdown selector. -->
	<Header lang='en' />
	<script is:inline>
		const masterDict = {en: {}, es: {}, fr: {}};
		function initTranslations() {
			document.querySelectorAll('.i18n-partial').forEach(script => {
				const partial = JSON.parse(script.dataset.payload);
				const prefix = script.dataset.prefix;
				for (const lang in partial) {
					for (const key in partial[lang]) {
						masterDict[lang][`${prefix}.${key}`] = partial[lang][key];
					}
				}
			});
		}
	
		window.setLanguage = (lang) => {
			const dict = masterDict[lang] || masterDict['en'];	
			document.querySelectorAll('[data-t]').forEach(el => {
				const key = el.getAttribute('data-t');
				if (dict[key]) 
					el.textContent = dict[key];
			});
			document.documentElement.lang = lang;
		}

		function autoDetectLanguage() {
			initTranslations();
			const browser = navigator.language.split('-')[0];
			const supported = Object.keys(masterDict);

			const targetLang = supported.includes(browser) ? browser : 'en';
			window.setLanguage(targetLang);
		}

		autoDetectLanguage();
	</script>
</Base>
